<Window 
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Exchange Berechtigungen Verwaltung" Height="875" Width="1200" WindowStartupLocation="CenterScreen"
        Background="#f9f9f9" MinWidth="950" MinHeight="650">
    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Background" Value="#f0f0f0"/>
            <Setter Property="Foreground" Value="#202020"/>
            <Setter Property="BorderBrush" Value="#e0e0e0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#e5e5e5"/>
                    <Setter Property="BorderBrush" Value="#d0d0d0"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#d0d0d0"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style TargetType="GroupBox">
            <Setter Property="BorderBrush" Value="#d4d4d4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Border Grid.Row="0" Grid.RowSpan="2" BorderThickness="{TemplateBinding BorderThickness}" BorderBrush="{TemplateBinding BorderBrush}" Background="{TemplateBinding Background}" CornerRadius="8"/>
                            <Border Grid.Row="0" Padding="5,0,5,0" Margin="10,0,0,0" Background="{TemplateBinding Background}">
                                <ContentPresenter ContentSource="Header"/>
                            </Border>
                            <ContentPresenter Grid.Row="1" Margin="{TemplateBinding Padding}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style TargetType="TextBox">
            <Setter Property="BorderBrush" Value="#d4d4d4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,2"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="{TemplateBinding Padding}" 
                                         VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Diese Templates müssen VOR dem ComboBox-Style definiert werden -->
        <ControlTemplate x:Key="ComboBoxToggleButtonTemplate" TargetType="ToggleButton">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="20" />
                </Grid.ColumnDefinitions>
                <Border x:Name="Border" Grid.ColumnSpan="2" CornerRadius="4" Background="#f0f0f0" BorderBrush="#d4d4d4" BorderThickness="1" />
                <Path x:Name="Arrow" Grid.Column="1" Fill="#444444" HorizontalAlignment="Center" VerticalAlignment="Center"
                      Data="M 0 0 L 4 4 L 8 0 Z"/>
            </Grid>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="true">
                    <Setter TargetName="Border" Property="Background" Value="#e5e5e5" />
                </Trigger>
                <Trigger Property="IsChecked" Value="true">
                    <Setter TargetName="Border" Property="Background" Value="#e0e0e0" />
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
        
        <ControlTemplate x:Key="ComboBoxTextBox" TargetType="TextBox">
            <Border x:Name="PART_ContentHost" Focusable="False" Background="{TemplateBinding Background}" />
        </ControlTemplate>
        
        <Style TargetType="ComboBox">
            <Setter Property="BorderBrush" Value="#d4d4d4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton Name="ToggleButton" Template="{StaticResource ComboBoxToggleButtonTemplate}" Grid.Column="2"
                                    Focusable="false" IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                    ClickMode="Press">
                            </ToggleButton>
                            <ContentPresenter Name="ContentSite" IsHitTestVisible="False"
                                    Content="{TemplateBinding SelectionBoxItem}"
                                    ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                    ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                    VerticalAlignment="Center" HorizontalAlignment="Left"
                                    Margin="{TemplateBinding Padding}"/>
                            <TextBox x:Name="PART_EditableTextBox"
                                    Style="{x:Null}" Template="{StaticResource ComboBoxTextBox}"
                                    HorizontalAlignment="Left" VerticalAlignment="Center"
                                    Margin="{TemplateBinding Padding}"
                                    Focusable="True" Visibility="Hidden" IsReadOnly="{TemplateBinding IsReadOnly}"/>
                            <Popup Name="Popup"
                                    Placement="Bottom"
                                    IsOpen="{TemplateBinding IsDropDownOpen}"
                                    AllowsTransparency="True" Focusable="False"
                                    PopupAnimation="Slide">

                                <Grid Name="DropDown"
                                    SnapsToDevicePixels="True"                
                                    MinWidth="{TemplateBinding ActualWidth}"
                                    MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder" Background="White" BorderThickness="1" BorderBrush="#d4d4d4" CornerRadius="0,0,4,4"/>
                                    <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained" />
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style TargetType="DataGrid">
            <Setter Property="BorderBrush" Value="#d4d4d4"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowBackground" Value="#ffffff"/>
            <Setter Property="AlternatingRowBackground" Value="#f5f5f5"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#e5e5e5"/>
            <Setter Property="VerticalGridLinesBrush" Value="#e5e5e5"/>
        </Style>
        
        <Style TargetType="TabItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border Name="Border" BorderThickness="1,1,1,0" BorderBrush="Transparent" CornerRadius="4,4,0,0" Margin="2,0">
                            <ContentPresenter x:Name="ContentSite" VerticalAlignment="Center" HorizontalAlignment="Center"
                                ContentSource="Header" Margin="10,5"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#ffffff" />
                                <Setter TargetName="Border" Property="BorderBrush" Value="#d4d4d4" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter TargetName="Border" Property="Background" Value="#f0f0f0" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#e5e5e5" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Border CornerRadius="8" Background="#ffffff" BorderBrush="#e0e0e0" BorderThickness="1" Margin="5">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="60"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="30"/>
            </Grid.RowDefinitions>

            <!-- Header mit abgerundeten Ecken -->
            <Border Background="#0067c0" Grid.Row="0" CornerRadius="8,8,0,0">
                <DockPanel LastChildFill="True">
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" Margin="10,0">
                        <Button x:Name="btnSettings" Width="36" Height="36" Margin="5,0" ToolTip="Einstellungen" Content="⚙" Background="Transparent" BorderThickness="0" Foreground="White"/>
                        <Button x:Name="btnInfo" Width="36" Height="36" Margin="5,0" ToolTip="Info" Content="?" Background="Transparent" BorderThickness="0" Foreground="White"/>
                        <Button x:Name="btnClose" Width="36" Height="36" Margin="5,0" ToolTip="Schließen" Content="✕" Background="Transparent" BorderThickness="0" Foreground="White"/>
                    </StackPanel>
                    <TextBlock Text="Exchange Berechtigungen Verwaltung" Foreground="White" FontSize="22" VerticalAlignment="Center" Margin="14,0"/>
                    <TextBlock x:Name="txtVersion" Text="v0.0.5" Foreground="White" FontSize="12" VerticalAlignment="Bottom" Margin="5,0,0,5"/>
                </DockPanel>
            </Border>

            <!-- Main Content mit abgerundetem Navigationsbereich -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="220" MinWidth="180"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Navigation Panel mit abgerundeten Ecken -->
                <Border Background="#f3f3f3" Grid.Column="0" CornerRadius="0,0,0,8" Margin="0,0,0,0">
                    <StackPanel Margin="14,14,14,10">
                        <Button x:Name="btnConnect" Content="Mit Exchange verbinden" Height="36" Margin="0,10" />
                        <TextBlock Text="Verbindungsstatus:" Margin="4,14,0,5" />
                        <TextBlock x:Name="txtConnectionStatus" Text="Nicht verbunden" Foreground="#d83b01" Margin="4,0,0,20" FontWeight="SemiBold" />
                        
                        <TextBlock Text="Navigation" FontWeight="Bold" Margin="4,14,0,8" />
                        <Button x:Name="btnNavCalendar" Content="Kalenderberechtigungen" Height="36" Margin="0,6" />
                        <Button x:Name="btnNavMailbox" Content="Postfachberechtigungen" Height="36" Margin="0,6" />
                        <Button x:Name="btnNavAudit" Content="Audit &amp; Information" Height="36" Margin="0,6" />
                        <Button x:Name="btnNavTroubleshooting" Content="Troubleshooting" Height="36" Margin="0,6" />
                        
                        <Button x:Name="btnCheckPrerequisites" Content="Überprüfe Module" Height="36" Margin="0,36,0,6" />
                        <Button x:Name="btnInstallPrerequisites" Content="Installiere Module" Height="36" Margin="0,6" />
                    </StackPanel>
                </Border>

                <!-- Content Tabs mit abgerundeten Tab-Headers -->
                <TabControl x:Name="tabContent" Grid.Column="1" Margin="10" Background="Transparent" BorderThickness="0">
                    <!-- Calendar Tab -->
                    <TabItem x:Name="tabCalendar" Header="Kalenderberechtigungen" Visibility="Collapsed">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Hilfe Link -->
                                <TextBlock x:Name="helpLinkCalendar" Text="Hilfe zu Kalenderberechtigungen" Grid.Row="0" 
                                           Foreground="#0067c0" TextDecorations="Underline" HorizontalAlignment="Right" 
                                           Margin="0,0,0,10" Cursor="Hand"/>
                                
                                <!-- Berechtigung hinzufügen/entfernen -->
                                <GroupBox Header="Kalenderberechtigungen verwalten" Grid.Row="1" Margin="0,10,0,15" Background="#ffffff">
                                    <Grid Margin="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1.2*"/>
                                            <ColumnDefinition Width="2*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Column="0" Grid.Row="0" Text="Quell-Postfach (Kalender-Besitzer):" 
                                                   Margin="0,10,10,5" VerticalAlignment="Center"/>
                                        <TextBox x:Name="txtCalendarSource" Grid.Column="1" Grid.Row="0" 
                                                 Margin="0,10,0,5" Height="30"/>

                                        <TextBlock Grid.Column="0" Grid.Row="1" Text="Ziel-Benutzer (erhält Berechtigung):" 
                                                   Margin="0,5,10,5" VerticalAlignment="Center"/>
                                        <TextBox x:Name="txtCalendarTarget" Grid.Column="1" Grid.Row="1" 
                                                 Margin="0,5,0,5" Height="30"/>

                                        <TextBlock Grid.Column="0" Grid.Row="2" Text="Berechtigungsstufe:" 
                                                   Margin="0,5,10,10" VerticalAlignment="Center"/>
                                        <ComboBox x:Name="cmbCalendarPermission" Grid.Column="1" Grid.Row="2" 
                                                  Margin="0,5,0,10" Height="30"/>

                                        <StackPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="3" 
                                                    Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                            <Button x:Name="btnAddCalendarPermission" Content="Berechtigung hinzufügen" 
                                                    Width="180" Height="35" Margin="0,0,10,0"/>
                                            <Button x:Name="btnRemoveCalendarPermission" Content="Berechtigung entfernen" 
                                                    Width="180" Height="35"/>
                                        </StackPanel>
                                    </Grid>
                                </GroupBox>

                                <!-- Berechtigungen anzeigen -->
                                <GroupBox Header="Kalenderberechtigungen anzeigen" Grid.Row="2" Margin="0,0,0,15" Background="#ffffff">
                                    <Grid Margin="12">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" Grid.Row="0" Text="Postfach:" 
                                                   Margin="0,0,10,0" VerticalAlignment="Center"/>
                                        <TextBox x:Name="txtCalendarMailboxUser" Grid.Column="1" Grid.Row="0" 
                                                 Margin="0" Height="30"/>
                                        <Button x:Name="btnShowCalendarPermissions" Content="Berechtigungen anzeigen" 
                                                Grid.Column="2" Grid.Row="0" Width="180" Height="30" Margin="10,0,0,0"/>
                                        
                                        <!-- Anzeige der allgemeinen Benutzerberechtigungen -->
                                        <TextBlock Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1" 
                                                   Text="Benutzerberechtigungen:" Margin="0,15,0,5" FontWeight="SemiBold"/>
                                        <DataGrid x:Name="lstCalendarPermissions" Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="2" 
                                                  Margin="0,5,0,10" MinHeight="180" AutoGenerateColumns="False" 
                                                  IsReadOnly="True" HeadersVisibility="Column">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Benutzer" Binding="{Binding User}" Width="*"/>
                                                <DataGridTextColumn Header="Berechtigungen" Binding="{Binding AccessRights}" Width="*"/>
                                                <DataGridTextColumn Header="Geerbt" Binding="{Binding IsInherited}" Width="80"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </Grid>
                                </GroupBox>

                                <!-- Standard-Berechtigungen -->
                                <GroupBox Header="Standard-Kalenderberechtigungen" Grid.Row="3" Margin="0,0,0,10" Background="#ffffff">
                                    <Grid Margin="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1.2*"/>
                                            <ColumnDefinition Width="2*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Column="0" Grid.Row="0" Text="Standard-Berechtigungsstufe:" 
                                                   Margin="0,5,10,5" VerticalAlignment="Center"/>
                                        <ComboBox x:Name="cmbDefaultPermission" Grid.Column="1" Grid.Row="0" 
                                                  Margin="0,5,0,5" Height="30"/>

                                        <StackPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="1" 
                                                    Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                                            <Button x:Name="btnSetDefaultPermission" Content="Setze Default-Berechtigungen" 
                                                    Width="190" Height="35" Margin="0,0,10,0"/>
                                            <Button x:Name="btnSetAnonymousPermission" Content="Setze Anonymous-Berechtigungen" 
                                                    Width="210" Height="35" Margin="0,0,10,0"/>
                                            <Button x:Name="btnSetAllCalPermission" Content="Auf alle Postfächer anwenden" 
                                                    Width="190" Height="35" Background="#d3e0fe"/>
                                        </StackPanel>
                                    </Grid>
                                </GroupBox>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Mailbox Tab -->
                    <TabItem x:Name="tabMailbox" Header="Postfachberechtigungen" Visibility="Collapsed">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Hilfe Link -->
                                <TextBlock x:Name="helpLinkMailbox" Text="Hilfe zu Postfachberechtigungen" Grid.Row="0" 
                                           Foreground="#0067c0" TextDecorations="Underline" HorizontalAlignment="Right" 
                                           Margin="0,0,0,10" Cursor="Hand"/>
                                
                                <!-- FullAccess Berechtigungen -->
                                <GroupBox Header="FullAccess Berechtigungen verwalten" Grid.Row="1" Margin="0,10" Background="#ffffff">
                                    <Grid Margin="10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*"/>
                                            <ColumnDefinition Width="3*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Column="0" Grid.Row="0" Text="Quell-Postfach (Postfach-Besitzer):" 
                                                   Margin="0,10,10,5" VerticalAlignment="Center"/>
                                        <TextBox x:Name="txtMailboxSource" Grid.Column="1" Grid.Row="0" 
                                                 Margin="0,10,0,5" Height="30"/>

                                        <TextBlock Grid.Column="0" Grid.Row="1" Text="Ziel-Benutzer (erhält Berechtigung):" 
                                                   Margin="0,5,10,5" VerticalAlignment="Center"/>
                                        <TextBox x:Name="txtMailboxTarget" Grid.Column="1" Grid.Row="1" 
                                                 Margin="0,5,0,5" Height="30"/>

                                        <StackPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="2" 
                                                    Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,5">
                                            <Button x:Name="btnAddMailboxPermission" Content="FullAccess hinzufügen" 
                                                    Width="180" Height="35" Margin="10,0"/>
                                            <Button x:Name="btnRemoveMailboxPermission" Content="FullAccess entfernen" 
                                                    Width="180" Height="35" Margin="10,0"/>
                                        </StackPanel>
                                    </Grid>
                                </GroupBox>

                                <!-- SendAs und SendOnBehalf Berechtigungen -->
                                <GroupBox Header="Weitere Berechtigungen verwalten" Grid.Row="2" Margin="0,15,0,15" Background="#ffffff">
                                    <Grid Margin="10">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Hinweis mit besserem Styling -->
                                        <Border Grid.Row="0" Background="#f0f7ff" BorderBrush="#b3d1ff" BorderThickness="1" 
                                                CornerRadius="4" Padding="10" Margin="0,0,0,15">
                                            <TextBlock Text="Es werden die gleichen Werte für Quell- und Zielbenutzer wie oben verwendet." 
                                                       Foreground="#0067c0" TextWrapping="Wrap"/>
                                        </Border>

                                        <Grid Grid.Row="1">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="1*"/>
                                                <ColumnDefinition Width="1*"/>
                                                <ColumnDefinition Width="1*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- SendAs Berechtigungen -->
                                            <GroupBox Grid.Column="0" Header="SendAs Berechtigungen" Margin="0,0,5,0" Background="#ffffff">
                                                <StackPanel Margin="5,10">
                                                    <Button x:Name="btnAddSendAs" Content="SendAs hinzufügen" 
                                                            Height="35" Margin="0,5"/>
                                                    <Button x:Name="btnRemoveSendAs" Content="SendAs entfernen" 
                                                            Height="35" Margin="0,10,0,5"/>
                                                    <Button x:Name="btnShowSendAs" Content="SendAs anzeigen" 
                                                            Height="35" Margin="0,5"/>
                                                </StackPanel>
                                            </GroupBox>

                                            <!-- SendOnBehalf Berechtigungen -->
                                            <GroupBox Grid.Column="1" Header="SendOnBehalf" Margin="5,0" Background="#ffffff">
                                                <StackPanel Margin="5,10">
                                                    <Button x:Name="btnAddSendOnBehalf" Content="SendOnBehalf hinzufügen" 
                                                            Height="35" Margin="0,5"/>
                                                    <Button x:Name="btnRemoveSendOnBehalf" Content="SendOnBehalf entfernen" 
                                                            Height="35" Margin="0,10,0,5"/>
                                                    <Button x:Name="btnShowSendOnBehalf" Content="SendOnBehalf anzeigen" 
                                                            Height="35" Margin="0,5"/>
                                                </StackPanel>
                                            </GroupBox>

                                            <!-- Alle Berechtigungen -->
                                            <GroupBox Grid.Column="2" Header="Alle Berechtigungen anzeigen" Margin="5,0,0,0" Background="#ffffff">
                                                <StackPanel Margin="5,10">
                                                    <TextBlock Text="Postfach:" Margin="0,5"/>
                                                    <TextBox x:Name="txtMailboxUser" Height="30" Margin="0,0,0,10"/>
                                                    <Button x:Name="btnShowMailboxPermissions" Content="Berechtigungen anzeigen" 
                                                            Height="35" Margin="0,5"/>
                                                </StackPanel>
                                            </GroupBox>
                                        </Grid>
                                    </Grid>
                                </GroupBox>

                                <!-- Berechtigungen anzeigen -->
                                <GroupBox Header="Aktuelle Berechtigungen" Grid.Row="3" Margin="0,5" Background="#ffffff">
                                    <Grid Margin="10">
                                        <DataGrid x:Name="lstMailboxPermissions" 
                                                  Margin="0,10" MinHeight="200" AutoGenerateColumns="False" 
                                                  IsReadOnly="True" HeadersVisibility="Column">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Postfach" Binding="{Binding Identity}" Width="1*"/>
                                                <DataGridTextColumn Header="Benutzer" Binding="{Binding User}" Width="1*"/>
                                                <DataGridTextColumn Header="Berechtigungstyp" Binding="{Binding AccessType}" Width="0.7*"/>
                                                <DataGridTextColumn Header="Berechtigungen" Binding="{Binding AccessRights}" Width="1.3*"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </Grid>
                                </GroupBox>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Audit Tab -->
                    <TabItem x:Name="tabMailboxAudit" Header="Audit &amp; Information" Visibility="Collapsed">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Hilfe Link -->
                                <TextBlock x:Name="helpLinkAudit" Text="Hilfe zu Audit &amp; Information" Grid.Row="0" Foreground="#0067c0" TextDecorations="Underline" HorizontalAlignment="Right" Margin="0,0,0,10" Cursor="Hand"/>
                                
                                <!-- Audit-Optionen -->
                                <GroupBox Header="Exchange Audit &amp; Information" Grid.Row="1" Margin="0,10" Background="#ffffff">
                                    <Grid Margin="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="1*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Text="Postfach/Benutzer:" Grid.Row="0" Grid.Column="0" Margin="0,0,8,5"/>
                                        <TextBox x:Name="txtAuditMailbox" Grid.Row="1" Grid.Column="0" Height="32" Margin="0,0,8,15"/>
                                        
                                        <TextBlock Text="Kategorie:" Grid.Row="0" Grid.Column="1" Margin="8,0,8,5"/>
                                        <ComboBox x:Name="cmbAuditCategory" Grid.Row="1" Grid.Column="1" Height="32" Margin="8,0,8,15"/>
                                        
                                        <TextBlock Text="Typ:" Grid.Row="0" Grid.Column="2" Margin="8,0,0,5"/>
                                        <ComboBox x:Name="cmbAuditType" Grid.Row="1" Grid.Column="2" Height="32" Margin="8,0,0,15"/>
                                        
                                        <Button x:Name="btnRunAudit" Content="Audit ausführen" Grid.Row="2" Grid.Column="1" Height="32"/>
                                    </Grid>
                                </GroupBox>

                                <!-- Audit-Ergebnisse mit abgerundeten Ecken -->
                                <Border Grid.Row="2" Background="#ffffff" CornerRadius="8" BorderThickness="1" BorderBrush="#d4d4d4" Margin="0,14">
                                    <TextBox x:Name="txtAuditResult" Margin="8" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" IsReadOnly="True"
                                            BorderThickness="0" Background="Transparent" MinHeight="250"/>
                                </Border>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Troubleshooting Tab -->
                    <TabItem x:Name="tabTroubleshooting" Header="Troubleshooting" Visibility="Collapsed">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Hilfe Link -->
                                <TextBlock x:Name="helpLinkTroubleshooting" Text="Hilfe zum Troubleshooting" Grid.Row="0" Foreground="#0067c0" TextDecorations="Underline" HorizontalAlignment="Right" Margin="0,0,0,10" Cursor="Hand"/>
                                
                                <!-- Diagnose-Optionen -->
                                <GroupBox Header="Exchange Online Diagnostics" Grid.Row="1" Margin="0,10" Background="#ffffff">
                                    <Grid Margin="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="3*"/>
                                            <ColumnDefinition Width="4*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- ListBox mit abgerundeten Ecken -->
                                        <Border Grid.Row="0" Grid.RowSpan="3" Grid.Column="0" Background="#ffffff" CornerRadius="4" BorderThickness="1" BorderBrush="#d4d4d4" Margin="0,0,10,0">
                                            <ListBox x:Name="lstDiagnostics" Height="215" Margin="1" BorderThickness="0"/>
                                        </Border>

                                        <StackPanel Grid.Row="0" Grid.Column="1">
                                            <TextBlock Text="Benutzer 1 (wenn erforderlich):" Margin="0,0,0,5"/>
                                            <TextBox x:Name="txtDiagnosticUser" Height="32"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,14,0,0">
                                            <TextBlock Text="Benutzer 2 (falls erforderlich):" Margin="0,0,0,5"/>
                                            <TextBox x:Name="txtDiagnosticUser2" Height="32"/>
                                        </StackPanel>

                                        <StackPanel Grid.Row="2" Grid.Column="1" Margin="0,14,0,0">
                                            <TextBlock Text="E-Mail (falls erforderlich):" Margin="0,0,0,5"/>
                                            <TextBox x:Name="txtDiagnosticEmail" Height="32" Margin="0,0,0,14"/>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <Button x:Name="btnRunDiagnostic" Content="Diagnose ausführen" Height="36" Width="130" Margin="0,0,5,0"/>
                                                <Button x:Name="btnAdminCenter" Content="Admin Center" Height="36" Width="110" Margin="5,0,0,0"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </GroupBox>

                                <!-- Diagnose-Ergebnisse mit abgerundeten Ecken -->
                                <Border Grid.Row="2" Background="#ffffff" CornerRadius="8" BorderThickness="1" BorderBrush="#d4d4d4" Margin="0,14">
                                    <TextBox x:Name="txtDiagnosticResult" Margin="8" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" IsReadOnly="True" 
                                            BorderThickness="0" Background="Transparent" MinHeight="200"/>
                                </Border>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
            </Grid>

            <!-- Status Bar mit abgerundeten Ecken -->
            <Border Background="#f3f3f3" Grid.Row="2" CornerRadius="0,0,8,8">
                <DockPanel LastChildFill="True">
                    <TextBlock x:Name="txtStatus" Text="Bereit" Margin="14,0,0,0" VerticalAlignment="Center"/>
                </DockPanel>
            </Border>
        </Grid>
    </Border>
</Window>
